<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catálogo - Tienda PC (Modo Gaming)</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet" />

  <style>
    :root{
      --accent1: #061022;
      --accent2: #0b1222;
      --glow: #00d4ff;
      --accent-strong: #0066ff;
      --card-bg: rgba(10,14,39,0.95);
      --muted: #9aa7c7;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Inter',sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(0,102,255,0.06), transparent 10%),
                  linear-gradient(180deg, var(--accent1) 0%, var(--accent2) 100%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
    }

    /* NAVBAR */
    .navbar {
      background: linear-gradient(135deg, rgba(0,8,20,0.6), rgba(2,6,20,0.8));
      border-bottom: 1px solid rgba(255,255,255,0.03);
      padding: .9rem 1rem;
      backdrop-filter: blur(6px);
    }
    .navbar-brand {
      font-weight:800;
      letter-spacing: .4px;
      color: white;
    }
    .nav-link { color: rgba(230,238,248,0.85) !important; font-weight:600 }
    .btn-cart {
      background: linear-gradient(90deg, var(--accent-strong), var(--glow));
      border: none;
      border-radius: 999px;
      padding: .45rem .9rem;
      color: white;
      box-shadow: 0 6px 20px rgba(0,102,255,0.12);
    }
    .cart-badge { background: #ff4757; color: white; border-radius: 50%; padding: 0 .45rem; font-weight:700; margin-left:6px }

    /* HERO */
    .hero {
      padding: 2.2rem 0;
      text-align: center;
    }
    .hero h1 { font-size: 2.1rem; font-weight:800; margin-bottom:.3rem; color: #fff; text-shadow: 0 6px 30px rgba(0,0,0,0.6) }
    .hero p { color: var(--muted); margin-bottom: .8rem }

    /* FILTERS */
    .filters { display:flex; gap:.5rem; flex-wrap:wrap; justify-content:center; margin: .8rem 0 1.6rem }
    .filter-chip {
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.03);
      padding: .45rem .85rem;
      border-radius: 999px;
      color: var(--muted);
      cursor: pointer;
      font-weight:700;
    }
    .filter-chip.active { background: linear-gradient(90deg,var(--accent-strong),var(--glow)); color: white; box-shadow: 0 8px 30px rgba(0,102,255,0.12) }

    /* CARDS - GRID */
    .product-card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.03);
      border-radius: 12px;
      overflow: hidden;
      height: 100%;
      display:flex;
      flex-direction:column;
      transition: transform .25s ease, box-shadow .25s ease;
    }
    .product-card:hover { transform: translateY(-8px); box-shadow: 0 30px 80px rgba(0,0,0,0.6) }
    .product-img {
      padding: 1.25rem;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(0,0,0,0.15), rgba(0,0,0,0.05));
      height: 180px;
    }
    .product-img img { max-width:100%; max-height:100%; object-fit:contain; filter: drop-shadow(0 12px 30px rgba(0,102,255,0.06)); }
    .card-body { padding: 1rem; display:flex;flex-direction:column; gap:.5rem; flex:1 }
    .card-title { font-weight:800; color: #ffffff; font-size:1rem }
    .product-specs { display:flex; gap:.4rem; flex-wrap:wrap }
    .spec-badge {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.03);
      padding:.2rem .5rem;
      border-radius:999px;
      color: var(--muted);
      font-weight:700;
      font-size:.8rem;
    }
    .product-price { font-weight:900; font-size:1.15rem; background: linear-gradient(90deg,var(--accent-strong),var(--glow)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-top:auto }

    .btn-add {
      margin-top:.6rem;
      background: linear-gradient(90deg,var(--accent-strong),var(--glow));
      border: none;
      color:white;
      border-radius: 999px;
      padding:.52rem .9rem;
      font-weight:800;
      box-shadow: 0 10px 30px rgba(0,102,255,0.08);
    }

    /* OFFCANVAS */
    .offcanvas { background: linear-gradient(180deg,#071026,#081323); color: #e6eef8; border-left: 1px solid rgba(255,255,255,0.03) }
    .offcanvas-header { border-bottom: 1px solid rgba(255,255,255,0.03); }
    .cart-item { display:flex; gap:.8rem; align-items:center; padding:.6rem; border-radius:10px; background: rgba(255,255,255,0.02); margin-bottom:.6rem }
    .cart-item img { width:56px; height:56px; object-fit:contain; border-radius:8px; background: rgba(255,255,255,0.02); padding:.2rem }

    /* FOOTER */
    footer { text-align:center; padding:1.4rem 0; color:var(--muted); margin-top:2.2rem; border-top: 1px solid rgba(255,255,255,0.02) }

    @media (max-width:768px) {
      .product-img { height:140px }
    }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="index.html"><i class="fas fa-microchip me-2"></i>TIENDA PC</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
          <li class="nav-item"><a class="nav-link active" href="productos.html">Catálogo</a></li>
          <li class="nav-item"><a class="nav-link" href="contacto.html">Contacto</a></li>
        </ul>
        <div class="d-flex align-items-center">
          <button class="btn btn-cart me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartDrawer" aria-controls="cartDrawer">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count" class="cart-badge">0</span>
          </button>
          <a class="btn btn-sm" href="registro.html" style="color:#cfe9ff; border:1px solid rgba(255,255,255,0.03); border-radius:8px; padding:.45rem .8rem">Acceder</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <div class="container">
      <h1>Catálogo — Modo Gaming</h1>
      <p>Procesadores y GPUs — Intel, AMD Ryzen, NVIDIA y AMD. Agrega al carrito y procede al pago.</p>
      <div class="mt-2">
        <a href="#intel" class="btn btn-sm btn-outline-light me-1">Intel</a>
        <a href="#ryzen" class="btn btn-sm btn-outline-light me-1">Ryzen</a>
        <a href="#nvidia" class="btn btn-sm btn-outline-light me-1">NVIDIA</a>
        <a href="#amd" class="btn btn-sm btn-outline-light">AMD</a>
      </div>
    </div>
  </header>

  <main class="container my-4">

    <!-- FILTERS -->
    <div class="filters">
      <div class="filter-chip active" data-filter="all">Todos</div>
      <div class="filter-chip" data-filter="intel">Intel</div>
      <div class="filter-chip" data-filter="ryzen">Ryzen</div>
      <div class="filter-chip" data-filter="nvidia">NVIDIA</div>
      <div class="filter-chip" data-filter="amd">AMD</div>
      <div class="filter-chip" data-filter="budget">Hasta S/ 1500</div>
      <div class="filter-chip" data-filter="premium">Premium</div>
    </div>

    <!-- INTEL -->
    <section id="intel" class="mb-5">
      <h3 style="color:#dbe9ff; font-weight:800; margin-bottom:1rem">Procesadores Intel</h3>
      <div class="row g-4">
        <!-- i3 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="intel" data-price="499">
            <div class="product-img"><img src="img/i3.png" alt="Intel Core i3-13100"></div>
            <div class="card-body">
              <div class="card-title">Intel Core i3-13100</div>
              <div class="product-specs"><span class="spec-badge">4C/8T</span><span class="spec-badge">12MB</span></div>
              <div class="text-muted" style="font-size:.88rem">Rendimiento eficiente para tareas cotidianas y gaming ligero.</div>
              <div class="product-price">S/ 499</div>
              <button class="btn-add" data-nombre="Intel Core i3-13100" data-precio="499" data-img="img/intel_i3.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- i5 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="intel" data-price="899">
            <div class="product-img"><img src="img/i5.jpg" alt="Intel Core i5-12400"></div>
            <div class="card-body">
              <div class="card-title">Intel Core i5-12400</div>
              <div class="product-specs"><span class="spec-badge">6C/12T</span><span class="spec-badge">18MB</span></div>
              <div class="text-muted" style="font-size:.88rem">Equilibrio ideal para gaming 1080p/1440p.</div>
              <div class="product-price">S/ 899</div>
              <button class="btn-add" data-nombre="Intel Core i5-12400" data-precio="899" data-img="img/intel_i5.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- i7 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="intel" data-price="1199">
            <div class="product-img"><img src="img/i7.png" alt="Intel Core i7-12700"></div>
            <div class="card-body">
              <div class="card-title">Intel Core i7-12700</div>
              <div class="product-specs"><span class="spec-badge">12C/20T</span><span class="spec-badge">25MB</span></div>
              <div class="text-muted" style="font-size:.88rem">Gran rendimiento para creación y streaming.</div>
              <div class="product-price">S/ 1,199</div>
              <button class="btn-add" data-nombre="Intel Core i7-12700" data-precio="1199" data-img="img/intel_i7.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RYZEN -->
    <section id="ryzen" class="mb-5">
      <h3 style="color:#dbe9ff; font-weight:800; margin-bottom:1rem">Procesadores AMD Ryzen</h3>
      <div class="row g-4">
        <!-- Ryzen 5 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="ryzen" data-price="599">
            <div class="product-img"><img src="img/ry5.jpg" alt="AMD Ryzen 5 5600"></div>
            <div class="card-body">
              <div class="card-title">AMD Ryzen 5 5600</div>
              <div class="product-specs"><span class="spec-badge">6C/12T</span><span class="spec-badge">32MB</span></div>
              <div class="text-muted" style="font-size:.88rem">Favorito por su relación precio/rendimiento.</div>
              <div class="product-price">S/ 599</div>
              <button class="btn-add" data-nombre="AMD Ryzen 5 5600" data-precio="599" data-img="img/ryzen_5.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- Ryzen 7 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="ryzen" data-price="999">
            <div class="product-img"><img src="img/ry7.png" alt="AMD Ryzen 7 5800X"></div>
            <div class="card-body">
              <div class="card-title">AMD Ryzen 7 5800X</div>
              <div class="product-specs"><span class="spec-badge">8C/16T</span><span class="spec-badge">32MB</span></div>
              <div class="text-muted" style="font-size:.88rem">Excelente multi-hilo para productividad y juego.</div>
              <div class="product-price">S/ 999</div>
              <button class="btn-add" data-nombre="AMD Ryzen 7 5800X" data-precio="999" data-img="img/ryzen_7.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- Ryzen 9 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="ryzen" data-price="1799">
            <div class="product-img"><img src="img/ry90.avif" alt="AMD Ryzen 9 7900X"></div>
            <div class="card-body">
              <div class="card-title">AMD Ryzen 9 7900X</div>
              <div class="product-specs"><span class="spec-badge">12C/24T</span><span class="spec-badge">64MB</span></div>
              <div class="text-muted" style="font-size:.88rem">Rendimiento extremo para creadores y juego.</div>
              <div class="product-price">S/ 1,799</div>
              <button class="btn-add" data-nombre="AMD Ryzen 9 7900X" data-precio="1799" data-img="img/ryzen_9.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- NVIDIA -->
    <section id="nvidia" class="mb-5">
      <h3 style="color:#dbe9ff; font-weight:800; margin-bottom:1rem">GPUs NVIDIA</h3>
      <div class="row g-4">
        <!-- RTX 3060 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="nvidia" data-price="1899">
            <div class="product-img"><img src="img/ind3060.png" alt="NVIDIA RTX 3060"></div>
            <div class="card-body">
              <div class="card-title">NVIDIA RTX 3060</div>
              <div class="product-specs"><span class="spec-badge">12GB</span><span class="spec-badge">Ray Tracing</span></div>
              <div class="text-muted" style="font-size:.88rem">Buena opción para 1080p/1440p.</div>
              <div class="product-price">S/ 1,899</div>
              <button class="btn-add" data-nombre="NVIDIA RTX 3060" data-precio="1899" data-img="img/rtx_3060.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- RTX 4070 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="nvidia" data-price="3499">
            <div class="product-img"><img src="img/rtx4070.jpg" alt="NVIDIA RTX 4070"></div>
            <div class="card-body">
              <div class="card-title">NVIDIA RTX 4070</div>
              <div class="product-specs"><span class="spec-badge">12GB</span><span class="spec-badge">DLSS 3</span></div>
              <div class="text-muted" style="font-size:.88rem">Eficiencia y potencia moderna.</div>
              <div class="product-price">S/ 3,499</div>
              <button class="btn-add" data-nombre="NVIDIA RTX 4070" data-precio="3499" data-img="img/rtx_4070.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- RTX 4090 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="nvidia" data-price="5999">
            <div class="product-img"><img src="img/rtx4090.png" alt="NVIDIA RTX 4090"></div>
            <div class="card-body">
              <div class="card-title">NVIDIA RTX 4090</div>
              <div class="product-specs"><span class="spec-badge">24GB</span><span class="spec-badge">Tope de gama</span></div>
              <div class="text-muted" style="font-size:.88rem">Máxima potencia para 4K y profesionales.</div>
              <div class="product-price">S/ 5,999</div>
              <button class="btn-add" data-nombre="NVIDIA RTX 4090" data-precio="5999" data-img="img/rtx_4090.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- AMD -->
    <section id="amd" class="mb-5">
      <h3 style="color:#dbe9ff; font-weight:800; margin-bottom:1rem">GPUs AMD</h3>
      <div class="row g-4">
        <!-- RX 6600 -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="amd" data-price="1299">
            <div class="product-img"><img src="img/adm6600.jpg" alt="AMD RX 6600"></div>
            <div class="card-body">
              <div class="card-title">AMD RX 6600</div>
              <div class="product-specs"><span class="spec-badge">8GB</span><span class="spec-badge">132W</span></div>
              <div class="text-muted" style="font-size:.88rem">Gran eficiencia para 1080p.</div>
              <div class="product-price">S/ 1,299</div>
              <button class="btn-add" data-nombre="AMD RX 6600" data-precio="1299" data-img="img/rx_6600.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- RX 7800 XT -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="amd" data-price="2499">
            <div class="product-img"><img src="img/rx7800.png" alt="AMD RX 7800 XT"></div>
            <div class="card-body">
              <div class="card-title">AMD RX 7800 XT</div>
              <div class="product-specs"><span class="spec-badge">16GB</span><span class="spec-badge">RDNA3</span></div>
              <div class="text-muted" style="font-size:.88rem">Rendimiento superior para 1440p/4K.</div>
              <div class="product-price">S/ 2,499</div>
              <button class="btn-add" data-nombre="AMD RX 7800 XT" data-precio="2499" data-img="img/rx_7800xt.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>

        <!-- RX 7900 XTX -->
        <div class="col-md-6 col-lg-4">
          <div class="product-card" data-brand="amd" data-price="4799">
            <div class="product-img"><img src="img/rx7900.png" alt="AMD RX 7900 XTX"></div>
            <div class="card-body">
              <div class="card-title">AMD RX 7900 XTX</div>
              <div class="product-specs"><span class="spec-badge">24GB</span><span class="spec-badge">RDNA3</span></div>
              <div class="text-muted" style="font-size:.88rem">Potencia extrema para 4K y más.</div>
              <div class="product-price">S/ 4,799</div>
              <button class="btn-add" data-nombre="AMD RX 7900 XTX" data-precio="4799" data-img="img/rx_7900xtx.jpg"><i class="fas fa-cart-plus me-2"></i>Agregar</button>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- OFFCANVAS CART -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="cartDrawer" aria-labelledby="cartDrawerLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="cartDrawerLabel"><i class="fas fa-shopping-bag me-2"></i>Tu carrito</h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <div id="cart-items" class="mb-3"></div>

      <div class="d-flex justify-content-between align-items-center mt-3">
        <strong>Total:</strong>
        <strong id="cart-total">S/ 0.00</strong>
      </div>

      <button id="checkout" class="btn btn-primary w-100 mt-3"><i class="fas fa-credit-card me-2"></i>Finalizar compra</button>
    </div>
  </div>

  <footer>
    <div class="container">
      <small>© 2025 Tienda PC — Hardware Profesional</small>
    </div>
  </footer>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    /******************************************************************
     * Carrito (modo gaming) - Guardado en localStorage:
     * llave carrito -> array de { nombre, precio, imagen, cantidad }
     * llave totalCarrito -> string número con 2 decimales
     * sesión de usuario: localStorage.usuarioActivo (JSON)
     ******************************************************************/

    // Inicialización
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

    // Utilidad para formatear
    function fmt(n) {
      return Number(n).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    // Actualiza badge, offcanvas y localStorage del total
    function actualizarCarritoUI() {
      const countEl = document.getElementById('cart-count');
      const itemsContainer = document.getElementById('cart-items');
      const totalEl = document.getElementById('cart-total');

      // limpiar
      itemsContainer.innerHTML = '';

      // cuenta total
      const cantidadTotal = carrito.reduce((s, p) => s + p.cantidad, 0);
      countEl.textContent = cantidadTotal;

      // si vacío
      if (carrito.length === 0) {
        itemsContainer.innerHTML = '<p class="text-muted">Tu carrito está vacío.</p>';
        totalEl.textContent = 'S/ 0.00';
        localStorage.setItem('carrito', JSON.stringify(carrito));
        localStorage.setItem('totalCarrito', (0).toFixed(2));
        return;
      }

      // render items
      let total = 0;
      carrito.forEach(p => {
        const subtotal = p.precio * p.cantidad;
        total += subtotal;

        const item = document.createElement('div');
        item.className = 'cart-item';
        item.innerHTML = `
          <img src="${p.imagen}" alt="${p.nombre}">
          <div style="flex:1">
            <div style="font-weight:800; font-size:.95rem">${p.nombre}</div>
            <div style="color:var(--muted); font-size:.85rem">S/ ${fmt(p.precio)} x ${p.cantidad}</div>
          </div>
          <div style="text-align:right">
            <div style="font-weight:800">S/ ${fmt(subtotal)}</div>
            <div class="mt-2 d-flex justify-content-end align-items-center">
              <button class="btn btn-sm qty-btn-decrease" data-nombre="${escapeHtml(p.nombre)}">−</button>
              <div style="width:8px"></div>
              <button class="btn btn-sm qty-btn-increase" data-nombre="${escapeHtml(p.nombre)}">+</button>
              <button class="btn btn-sm btn-outline-danger ms-2 btn-remove" data-nombre="${escapeHtml(p.nombre)}" title="Eliminar"><i class="fas fa-trash"></i></button>
            </div>
          </div>
        `;
        itemsContainer.appendChild(item);
      });

      // guardar y mostrar total
      totalEl.textContent = 'S/ ' + fmt(total);
      localStorage.setItem('carrito', JSON.stringify(carrito));
      localStorage.setItem('totalCarrito', total.toFixed(2));

      // attach events (delegación sería mejor, pero está bien aquí)
      document.querySelectorAll('.qty-btn-increase').forEach(btn => {
        btn.addEventListener('click', () => changeQty(btn.dataset.nombre, +1));
      });
      document.querySelectorAll('.qty-btn-decrease').forEach(btn => {
        btn.addEventListener('click', () => changeQty(btn.dataset.nombre, -1));
      });
      document.querySelectorAll('.btn-remove').forEach(btn => {
        btn.addEventListener('click', () => removeItem(btn.dataset.nombre));
      });
    }

    // seguridad: escapar strings usadas en atributos
    function escapeHtml(str) {
      return (''+str).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    }

    // Añadir producto
    function addProductToCart(nombre, precio, imagen) {
      const idx = carrito.findIndex(p => p.nombre === nombre);
      if (idx >= 0) {
        carrito[idx].cantidad += 1;
      } else {
        carrito.push({ nombre, precio: Number(precio), imagen, cantidad: 1 });
      }
      actualizarCarritoUI();
      // pequeño feedback visual: no bloquear el botón aquí, lo hacemos en el clic
    }

    // Cambiar cantidad
    function changeQty(nombreEscaped, delta) {
      const nombre = nombreEscaped.replace(/&quot;/g, '"').replace(/&#39;/g, "'");
      const idx = carrito.findIndex(p => p.nombre === nombre);
      if (idx === -1) return;
      carrito[idx].cantidad += delta;
      if (carrito[idx].cantidad <= 0) carrito.splice(idx, 1);
      actualizarCarritoUI();
    }

    // Eliminar
    function removeItem(nombreEscaped) {
      const nombre = nombreEscaped.replace(/&quot;/g, '"').replace(/&#39;/g, "'");
      carrito = carrito.filter(p => p.nombre !== nombre);
      actualizarCarritoUI();
    }

    // Conectar botones "Agregar"
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('.btn-add');
      if (!btn) return;
      const nombre = btn.dataset.nombre;
      const precio = Number(btn.dataset.precio);
      const img = btn.dataset.img || 'img/no-image.png';
      addProductToCart(nombre, precio, img);

      // feedback temporal en el botón
      const original = btn.innerHTML;
      btn.innerHTML = '<i class="fas fa-check me-2"></i>Agregado';
      btn.disabled = true;
      setTimeout(() => { btn.innerHTML = original; btn.disabled = false; }, 700);
    });

    // Filters
    document.querySelectorAll('.filter-chip').forEach(chip => {
      chip.addEventListener('click', function() {
        document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
        this.classList.add('active');
        const filter = this.dataset.filter;
        document.querySelectorAll('.product-card').forEach(card => {
          const brand = card.dataset.brand || '';
          const price = Number(card.dataset.price || 0);
          let show = true;
          if (filter === 'all') show = true;
          else if (filter === 'budget') show = price <= 1500;
          else if (filter === 'premium') show = price >= 3000;
          else show = brand === filter;
          const wrapper = card.closest('.col-md-6, .col-lg-4');
          if (wrapper) wrapper.style.display = show ? 'block' : 'none';
        });
      });
    });

    // Checkout: verifica sesión y redirige
    document.getElementById('checkout').addEventListener('click', function() {
      // recalcular por seguridad
      const recalTotal = carrito.reduce((s,p)=> s + p.precio*p.cantidad, 0);
      localStorage.setItem('totalCarrito', recalTotal.toFixed(2));
      localStorage.setItem('carrito', JSON.stringify(carrito));

      if (carrito.length === 0) {
        alert('Tu carrito está vacío. Agrega productos antes de pagar.');
        return;
      }

      const usuario = localStorage.getItem('usuarioActivo');
      if (!usuario) {
        if (confirm('Para finalizar la compra necesitas iniciar sesión o registrarte. ¿Ir a registro ahora?')) {
          window.location.href = 'registro.html';
        }
        return;
      }

      window.location.href = 'pago.html';
    });

    // Inicializar UI en carga
    document.addEventListener('DOMContentLoaded', () => {
      // Si localStorage tiene carrito (con clave distinta a la versión previa), intentar migrar:
      // soporte: si tienes items con estructura {sku,name,price,img,qty} los convertimos a la nueva estructura
      try {
        const raw = localStorage.getItem('tiendapc_cart_v1') || localStorage.getItem('cart') || null;
        if (raw && (!localStorage.getItem('carrito') || JSON.parse(localStorage.getItem('carrito')).length === 0)) {
          // intentar parsear y mapear
          try {
            const parsed = JSON.parse(raw);
            if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].sku) {
              carrito = parsed.map(i => ({
                nombre: i.name || i.nombre || i.sku,
                precio: Number(i.price || i.precio || i.data_price || 0),
                imagen: i.img || i.image || i.data_img || 'img/no-image.png',
                cantidad: i.qty || i.cantidad || 1
              }));
            }
          } catch(e){}
        }
      } catch(e){}

      // render
      actualizarCarritoUI();
    });

    // Renderizar cart cada vez que se abre el offcanvas (para sincronizar si cambia desde otra tab)
    const cartDrawer = document.getElementById('cartDrawer');
    cartDrawer.addEventListener('show.bs.offcanvas', function () {
      // recargar carrito desde localStorage por si se modificó
      carrito = JSON.parse(localStorage.getItem('carrito')) || carrito;
      actualizarCarritoUI();
    });

  </script>
</body>
</html>
